<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">


























































<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico" />
<title>Notepad Exercise 3 (1.5) | Android Developers</title>
<link href="../../../assets/android-developer-docs-devguide.css" rel="stylesheet" type="text/css" />
<script src="../../../assets/search_autocomplete.js" type="text/javascript"></script>
<script src="../../../reference/lists.js" type="text/javascript"></script>
<script src="../../../assets/jquery-resizable.min.js" type="text/javascript"></script>
<script src="../../../assets/android-developer-docs.js" type="text/javascript"></script>
<script type="text/javascript">
  setToRoot("../../../");
</script>
<noscript>
  <style type="text/css">
    html,body{overflow:auto;}
    #body-content{position:relative; top:0;}
    #doc-content{overflow:visible;border-left:3px solid #666;}
    #side-nav{padding:0;}
    #side-nav .toggle-list ul {display:block;}
    #resize-packages-nav{border-bottom:3px solid #666;}
  </style>
</noscript>
</head>

<body class="gc-documentation">

  <div id="header">
      <div id="headerLeft">
          <a href="../../../index.html" tabindex="-1"><img
              src="../../../assets/images/bg_logo.png" alt="Android Developers" /></a>
          <ul class="guide">
              <li id="home-link"><a href="../../../offline.html">
                  <span>Home</span></a></li>
              <li id="sdk-link"><a href="../../../sdk/1.5_r1/index.html"><span>SDK</span></a></li>
              <li id="guide-link"><a href="../../../guide/index.html"
                                  onClick="return loadLast('guide')"><span>Dev Guide</span></a></li>
              <li id="reference-link"><a href="../../../reference/packages.html" 
                                  onClick="return loadLast('reference')"><span>Reference</span></a></li>
              <li><a href="http://android-developers.blogspot.com"><span>Blog</span></a></li>
              <li id="community-link"><a href="../../../community/index.html"><span>Community</span></a></li>
          </ul>
      </div>
      <div id="headerRight">
          <div id="headerLinks">
            <!-- <img src="../../../assets/images/icon_world.jpg" alt="" /> -->
            <span class="text">
              <!-- &nbsp;<a href="#">English</a> | -->
              <a href="http://www.android.com">Android.com</a>
            </span>
          </div>
  <div id="search" >
      <div id="searchForm">
          <form accept-charset="utf-8" class="gsc-search-box" 
                onsubmit="return submit_search()">
            <table class="gsc-search-box" cellpadding="0" cellspacing="0"><tbody>
                <tr>
                  <td class="gsc-input">
                    <input id="search_autocomplete" class="gsc-input" type="text" size="33" autocomplete="off" 
                      title="search developer docs" name="q"
                      value="search developer docs" 
                      onFocus="search_focus_changed(this, true)" 
                      onBlur="search_focus_changed(this, false)" 
                      onkeydown="return search_changed(event, true, '../../../')" 
                      onkeyup="return search_changed(event, false, '../../../')" />
                  <div id="search_filtered_div" class="no-display">
                      <table id="search_filtered" cellspacing=0>
                      </table>
                  </div>
                  </td>
                  <td class="gsc-search-button">
                    <input type="submit" value="Search" title="search" id="search-button" class="gsc-search-button" />
                  </td>
                  <td class="gsc-clear-button">
                    <div title="clear results" class="gsc-clear-button">&nbsp;</div>
                  </td>
                </tr></tbody>
              </table>
          </form>
      </div><!-- searchForm -->
  </div><!-- search -->
      </div><!-- headerRight -->
  </div><!-- header -->

  <div class="g-section g-tpl-240" id="body-content">
    <div class="g-unit g-first side-nav-resizable" id="side-nav">
      <div id="devdoc-nav"><ul>

<li><h2>Android Basics</h2>
    <ul>
      <li><a href="../../../guide/basics/what-is-android.html">What Is Android?</a></li>
<!--  <li><a style="color:gray;">The Android SDK</a></li> -->
<!--  <li><a style="color:gray;">Walkthrough for Developers</a></li> -->
      <!-- quick overview of what it's like to develop on Android -->
    </ul>
</li>

<li><h2>Framework Topics</h2>
    <ul>
      <li><a href="../../../guide/topics/fundamentals.html">Application Fundamentals</a></li>
    </ul>
    <ul>
      <li class="toggle-list">
        <div><a href="../../../guide/topics/ui/index.html">User Interface</a></div>
          <ul>
            <li><a href="../../../guide/topics/ui/declaring-layout.html">Declaring Layout</a></li>
            <li><a href="../../../guide/topics/ui/menus.html">Creating Menus</a></li>
            <li><a href="../../../guide/topics/ui/layout-objects.html">Common Layout Objects</a></li>
            <li><a href="../../../guide/topics/ui/binding.html">Binding to Data with AdapterView</a></li>
            <li><a href="../../../guide/topics/ui/ui-events.html">Handling UI Events</a></li>
            <li><a href="../../../guide/topics/ui/themes.html">Applying Styles and Themes</a></li>
            <li><a href="../../../guide/topics/ui/custom-components.html">Building Custom Components</a></li>
            <li><a href="../../../guide/topics/ui/how-android-draws.html">How Android Draws Views</a></li>
          </ul>
      </li>
      <li class="toggle-list">
        <div><a href="../../../guide/topics/resources/index.html">Resources and Assests</a></div>
          <ul>
            <li><a href="../../../guide/topics/resources/resources-i18n.html">Resources and I18n</a></li>
            <li><a href="../../../guide/topics/resources/available-resources.html">Available Resource Types</a></li>
          </ul>
      </li>
      <li><a href="../../../guide/topics/intents/intents-filters.html">Intents and Intent Filters</a></li>
      <li><a href="../../../guide/topics/data/data-storage.html">Data Storage</a></li>
      <li><a href="../../../guide/topics/providers/content-providers.html">Content Providers</a></li>
<!--  <li><a style="color:gray;">Notifications</a></li> -->
      <li><a href="../../../guide/topics/security/security.html">Security and Permissions</a></li>
<!--  <li><a style="color:gray;">Processes and Threads</a></li> -->
<!--  <li><a style="color:gray;">Interprocess Communication</a></li> -->
      <li class="toggle-list">
        <div><a href="../../../guide/topics/manifest/manifest-intro.html">The AndroidManifest.xml File</a></div>
          <ul>
            <li><a href="../../../guide/topics/manifest/action-element.html">&lt;action&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/activity-element.html">&lt;activity&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/activity-alias-element.html">&lt;activity-alias&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/application-element.html">&lt;application&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/category-element.html">&lt;category&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/data-element.html">&lt;data&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/grant-uri-permission-element.html">&lt;grant-uri-permission&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/instrumentation-element.html">&lt;instrumentation&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/intent-filter-element.html">&lt;intent-filter&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/manifest-element.html">&lt;manifest&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/meta-data-element.html">&lt;meta-data&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/permission-element.html">&lt;permission&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/permission-group-element.html">&lt;permission-group&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/permission-tree-element.html">&lt;permission-tree&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/provider-element.html">&lt;provider&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/receiver-element.html">&lt;receiver&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/service-element.html">&lt;service&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/uses-configuration-element.html">&lt;uses-configuration&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/uses-library-element.html">&lt;uses-library&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/uses-permission-element.html">&lt;uses-permission&gt;</a></li>
            <li><a href="../../../guide/topics/manifest/uses-sdk-element.html">&lt;uses-sdk&gt;</a></li>
          </ul>
      </li>
    </ul>
    <ul>
      <li class="toggle-list">
        <div><a href="../../../guide/topics/graphics/index.html">Graphics</a></div>
          <ul>
            <li><a href="../../../guide/topics/graphics/2d-graphics.html">2D Graphics</a></li>
            <li><a href="../../../guide/topics/graphics/opengl.html">3D with OpenGL</a></li>
          </ul>
      </li>
      <li><a href="../../../guide/topics/media/index.html">Audio and Video</a></li>
<!--       <li class="toggle-list">
        <div><a style="color:gray;">Sensors</a></div>
          <ul>
            <li><a style="color:gray;">Camera</a></li>
            <li><a style="color:gray;">Compass</a></li>
            <li><a style="color:gray;">Accelerometer</a></li>
          </ul>
      </li> -->
      <li><a href="../../../guide/topics/location/index.html">Location and Maps</a></li>
<!--    <li class="toggle-list">
        <div><a style="color:gray;">Wireless Controls</a></div>
          <ul>
            <li><a style="color:gray;">Wi-Fi</a></li>
            <li><a style="color:gray;">Bluetooth</a></li>
          </ul>
      </li> -->
<!--  <li><a style="color:gray;">Localization</a></li>  -->
    </ul>
</li>

<li><h2>Developing</h2>
    <ul>
      <!--       <li><a style="color:gray;">Developing for Android</a></li>
      signing, upgrading, selecting a package name, select device profile, touch, trackball, dpad available, etc. -->
      <li><a href="../../../guide/developing/eclipse-adt.html">In Eclipse, with ADT</a></li>
      <li><a href="../../../guide/developing/other-ide.html">In Other IDEs</a></li>
      <li><a href="../../../guide/developing/device.html">On a Device</a></li>
      <li><a href="../../../guide/developing/debug-tasks.html">Debugging Tasks</a></li>
      <li class="toggle-list">
        <div><a href="../../../guide/developing/tools/index.html">Tools</a></div>
          <ul>
			<li><a href="../../../guide/developing/tools/aapt.html">aapt</a></li>
			<li><a href="../../../guide/developing/tools/adb.html">adb</a></li>
			<li><a href="../../../guide/developing/tools/othertools.html#android">android</a></li>
<!--			<li><a href="../../../guide/developing/tools/adt.html">ADT Plugin</a></li>-->
			<li><a href="../../../guide/developing/tools/aidl.html" >aidl</a></li>
			<li><a href="../../../guide/developing/tools/avd.html" >AVDs</a></li>
			<li><a href="../../../guide/developing/tools/ddms.html" >ddms</a></li>
			<li><a href="../../../guide/developing/tools/othertools.html#dx">dx</a></li>
			<li><a href="../../../guide/developing/tools/draw9patch.html">Draw 9-Patch</a></li>
			<li><a href="../../../guide/developing/tools/emulator.html">Emulator</a></li>
			<li><a href="../../../guide/developing/tools/hierarchy-viewer.html">Hierarchy Viewer</a></li>
			<li><a href="../../../guide/developing/tools/othertools.html#mksdcard">mksdcard</a></li>
			<li><a href="../../../guide/developing/tools/monkey.html">Monkey</a></li>
			<li><a href="../../../guide/developing/tools/adb.html#sqlite">sqlite3</a></li>
			<li><a href="../../../guide/developing/tools/traceview.html" >Traceview</a></li>
		  </ul></li>
<!--      <li><a href="../../../guide/developing/instrumentation/index.html">Instrumentation</a></li>
      <li><a style="color:gray;">JUnit</a></li> -->
   </ul>

</li>

<li><h2>Publishing</h2>
    <ul>
      <li><a href="../../../guide/publishing/app-signing.html">Signing Your Applications</a></li>
      <li><a href="../../../guide/publishing/versioning.html">Versioning Your Applications</a></li>
      <li><a href="../../../guide/publishing/preparing.html">Preparing to Publish</a></li>
      <li><a href="../../../guide/publishing/publishing.html">Publishing Your Applications</a></li>
    </ul>
</li>

<li><h2>Best Practices</h2>
    <ul>
      <li><a href="../../../guide/practices/design/performance.html">Designing for Performance</a></li>
      <li><a href="../../../guide/practices/design/responsiveness.html">Designing for Responsiveness</a></li>
      <li><a href="../../../guide/practices/design/seamlessness.html">Designing for Seamlessness</a></li>
<!--  <li><a style="color:gray;">User Interface Guidelines</a></li> -->
    </ul>
</li>

<li><h2>Tutorials and Sample Code</h2>
    <ul>
      <li><a href="../../../guide/tutorials/hello-world.html">Hello World</a></li>
      <li><a href="../../../guide/tutorials/views/index.html">Hello Views</a></li>
      <li><a href="../../../guide/tutorials/notepad/index.html">Notepad Tutorial</a></li>
    </ul>
    <ul>
    
      <li><a href="../../../../samples">Sample Code &raquo;</a></li>
    
    </ul>
</li>



<li><h2>Appendix</h2>
    <ul>
      <li><a href="../../../guide/appendix/media-formats.html">Supported Media Formats</a></li>
      <li><a href="../../../guide/appendix/g-app-intents.html">Intents List: Google Apps</a></li>
      <li><a href="../../../guide/appendix/glossary.html">Glossary</a></li>
      <li><a href="../../../guide/appendix/faq/index.html">FAQ</a></li>
    </ul>
</li>

</ul>

<script type="text/javascript">
<!--
    buildToggleLists();
//-->
</script>

      </div>
    </div> <!-- end side-nav -->
    <script>
      addLoadEvent(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>




<div class="g-unit" id="doc-content"><a name="top"></a>

<div id="jd-header" class="guide-header">
  <span class="crumb">
    
      <a href="index.html">Notepad Tutorial</a> >
    
  </span>
<h1>Notepad Exercise 3</h1>
</div>

  <div id="jd-content">


    <div class="jd-descr">
    <p><em>In this exercise, you will use life-cycle event callbacks to store and
retrieve application state data. This exercise demonstrates:</em></p>
<ul>
<li><em>Life-cycle events and how your application can use them</em></li>
<li><em>Techniques for maintaining application state</em></li>
</ul>

<div style="float:right;white-space:nowrap">
	[<a href="notepad-ex1.html">Exercise 1</a>]
	[<a href="notepad-ex2.html">Exercise 2</a>]
	<span style="color:#BBB;">
		[<a href="notepad-ex3.html" style="color:#BBB;">Exercise 3</a>]
	</span>
	[<a href="notepad-extra-credit.html">Extra Credit</a>]
</div>

<h2>Step 1</h2>

<p>Import <code>Notepadv3</code> into Eclipse. If you see an error about
<code>AndroidManifest.xml,</code> or some problems related to an Android zip
file, right click on the project and select <strong>Android Tools</strong> &gt;
<strong>Fix Project Properties</strong> from the popup menu. The starting point for this exercise is
exactly where we left off at the end of the Notepadv2. </p>
<p>The current application has some problems &mdash; hitting the back button when editing
causes a crash, and anything else that happens during editing will cause the
edits to be lost.</p>
<p>To fix this, we will move most of the functionality for creating and editing
the note into the NoteEdit class, and introduce a full life cycle for editing
notes.</p>

  <ol>
    <li>Remove the code in <code>NoteEdit</code> that parses the title and body
    from the extras Bundle. 
    <p>Instead, we are going to use the <code>DBHelper</code> class
    to access the notes from the database directly. All we need passed into the
    NoteEdit Activity is a <code>mRowId</code> (but only if we are editing, if creating we pass
    nothing). Remove these lines:</p>
      <pre>
String title = extras.getString(NotesDbAdapter.KEY_TITLE);
String body = extras.getString(NotesDbAdapter.KEY_BODY);</pre>
    </li>
    <li>We will also get rid of the properties that were being passed in
    the <code>extras</code> Bundle, which we were using to set the title
    and body text edit values in the UI. So delete:
    <pre>
if (title != null) {
    mTitleText.setText(title);
}
if (body != null) {
    mBodyText.setText(body);
}</pre>
    </li>
  </ol>
  
<h2>Step 2</h2>

<p>Create a class field for a <code>NotesDbAdapter</code> at the top of the NoteEdit class:</p>
    <pre>&nbsp;&nbsp;&nbsp; private NotesDbAdapter mDbHelper;</pre>
<p>Also add an instance of <code>NotesDbAdapter</code> in the
    <code>onCreate()</code> method (right below the <code>super.onCreate()</code> call):</p>
    <pre>
&nbsp;&nbsp;&nbsp; mDbHelper = new NotesDbAdapter(this);<br>
&nbsp;&nbsp;&nbsp; mDbHelper.open();</pre>
    
<h2>Step 3</h2>

<p>In <code>NoteEdit</code>, we need to check the <var>savedInstanceState</var> for the
<code>mRowId</code>, in case the note 
    editing contains a saved state in the Bundle, which we should recover (this would happen
  if our Activity lost focus and then restarted).</p>
  <ol>
    <li>
      Replace the code that currently initializes the <code>mRowId</code>:<br>
      <pre>
        mRowId = null;

        Bundle extras = getIntent().getExtras();
        if (extras != null) {
            mRowId = extras.getLong(NotesDbAdapter.KEY_ROWID);
        }
        </pre>
        with this:
        <pre>
        mRowId = savedInstanceState != null ? savedInstanceState.getLong(NotesDbAdapter.KEY_ROWID) 
                                            : null;
        if (mRowId == null) {
            Bundle extras = getIntent().getExtras();            
            mRowId = extras != null ? extras.getLong(NotesDbAdapter.KEY_ROWID) 
                                    : null;
        }
        </pre>
    </li>
    <li>
      Note the null check for <code>savedInstanceState</code>, and we still need to load up
      <code>mRowId</code> from the <code>extras</code> Bundle if it is not
      provided by the <code>savedInstanceState</code>. This is a ternary operator shorthand
      to safely either use the value or null if it is not present.	
    </li>
  </ol>
  
<h2>Step 4</h2>

<p>Next, we need to populate the fields based on the <code>mRowId</code> if we
    have it:</p>
    <pre>populateFields();</pre>
    <p>This goes before the <code>confirmButton.setOnClickListener()</code> line.
    We'll define this method in a moment.</p>

<h2>Step 5</h2>

<p>Get rid of the Bundle creation and Bundle value settings from the
    <code>onClick()</code> handler method. The Activity no longer needs to
    return any extra information to the caller. And because we no longer have
    an Intent to return, we'll use the shorter version
    of <code>setResult()</code>:</p>
    <pre>
public void onClick(View view) {
    setResult(RESULT_OK);
    finish();
}</pre>
    <p>We will take care of storing the updates or new notes in the database
    ourselves, using the life-cycle methods.</p>
    
    <p>The whole <code>onCreate()</code> method should now look like this:</p>
    <pre>
super.onCreate(savedInstanceState);
 
mDbHelper = new NotesDbAdapter(this);
mDbHelper.open();
 
setContentView(R.layout.note_edit);
 
mTitleText = (EditText) findViewById(R.id.title);
mBodyText = (EditText) findViewById(R.id.body);
 
Button confirmButton = (Button) findViewById(R.id.confirm);
 
mRowId = savedInstanceState != null ? savedInstanceState.getLong(NotesDbAdapter.KEY_ROWID) 
                                    : null;
if (mRowId == null) {
    Bundle extras = getIntent().getExtras();
    mRowId = extras != null ? extras.getLong(NotesDbAdapter.KEY_ROWID) 
                            : null;
}
 
populateFields();
 
confirmButton.setOnClickListener(new View.OnClickListener() {

    public void onClick(View view) {
        setResult(RESULT_OK);
        finish();
    }
     
});</pre>

<h2>Step 6</h2>

<p>Define the <code>populateFields()</code> method.</p>
    <pre>
private void populateFields() {
    if (mRowId != null) {
        Cursor note = mDbHelper.fetchNote(mRowId);
        startManagingCursor(note);
        mTitleText.setText(note.getString(
	            note.getColumnIndexOrThrow(NotesDbAdapter.KEY_TITLE)));
        mBodyText.setText(note.getString(
                note.getColumnIndexOrThrow(NotesDbAdapter.KEY_BODY)));
    }
}</pre>
<p>This method uses the <code>NotesDbAdapter.fetchNote()</code> method to find the right note to
edit, then it calls <code>startManagingCursor()</code> from the <code>Activity</code> class, which
is an Android convenience method provided to take care of the Cursor life-cycle. This will release
and re-create resources as dictated by the Activity life-cycle, so we don't need to worry about
doing that ourselves. After that, we just look up the title and body values from the Cursor
and populate the View elements with them.</p>
 

<h2>Step 7</h2>

    <div class="sidebox" style="border:2px solid #FFFFDD;float:right;
      background-color:#FFFFEE;margin-right:0px;margin-bottom:.5em;
      margin-top:1em;padding:0em;width:240px;">
      <h2 style="border:0;font-size:12px;padding:.5em .5em .5em 1em;margin:0;
      background-color:#FFFFDD;">Why handling life-cycle events is important</h2>
      <p style="padding-left:.5em;font-size:12px;margin:0; 
     padding:.0em .5em .5em 1em;">If you are used to always having control in your applications, you
      might not understand why all this life-cycle work is necessary. The reason
      is that in Android, you are not in control of your Activity, the 
      operating system is!</p>
      <p style="padding-left:.5em;font-size:12px;margin:0; 
     padding:.0em .5em .5em 1em;">As we have already seen, the Android model is based around activities
      calling each other. When one Activity calls another, the current Activity
      is paused at the very least, and may be killed altogether if the
      system starts to run low on resources. If this happens, your Activity will
      have to store enough state to come back up later, preferably in the same
      state it was in when it was killed.</p>
      <p style="padding-left:.5em;font-size:12px;margin:0;padding:.0em .5em .5em 1em;">
      Android has a <a href="../../../guide/topics/fundamentals.html#lcycles">well-defined life cycle</a>.
      Lifecycle events can happen even if you are not handing off control to
      another Activity explicitly. For example, perhaps a call comes in to the
      handset. If this happens, and your Activity is running, it will be swapped
      out while the call Activity takes over.</p>
    </div>

<p>Still in the <code>NoteEdit</code> class, we now override the methods 
   <code>onSaveInstanceState()</code>, <code>onPause()</code> and 
   <code>onResume()</code>. These are our life-cycle methods 
   (along with <code>onCreate()</code> which we already have).</p>

<p><code>onSaveInstanceState()</code> is called by Android if the
    Activity is being stopped and <strong>may be killed before it is
    resumed!</strong> This means it should store any state necessary to
    re-initialize to the same condition when the Activity is restarted. It is
    the counterpart to the <code>onCreate()</code> method, and in fact the
    <code>savedInstanceState</code> Bundle passed in to <code>onCreate()</code> is the same
    Bundle that you construct as <code>outState</code> in the
    <code>onSaveInstanceState()</code> method.</p>

<p><code>onPause()</code> and <code>onResume()</code> are also
    complimentary methods. <code>onPause()</code> is always called when the
    Activity ends, even if we instigated that (with a <code>finish()</code> call for example).
    We will use this to save the current note back to the database. Good
    practice is to release any resources that can be released during an
    <code>onPause()</code> as well, to take up less resources when in the
    passive state. <code>onResume()</code> will call our <code>populateFields()</code> method
    to read the note out of the database again and populate the fields.</p>

<p>So, add some space after the <code>populateFields()</code> method
  and add the following life-cycle methods:</p>
  <ol type="a">
    <li><code>
      onSaveInstanceState()</code>:
      <pre>
    &#64;Override
    protected void onSaveInstanceState(Bundle outState) {
        super.onSaveInstanceState(outState);
        outState.putLong(NotesDbAdapter.KEY_ROWID, mRowId);
    }</pre>
    </li>
    <li><code>
      onPause()</code>:
      <pre>
    &#64;Override
    protected void onPause() {
        super.onPause();
        saveState();
    }</pre>
    <p>We'll define <code>saveState()</code> next.</p>
    </li>
    <li><code>
      onResume()</code>:
      <pre>
    &#64;Override
    protected void onResume() {
        super.onResume();
        populateFields();
    }</pre>
    </li>
  </ol>


<h2 style="clear:right;">Step 8</h2>

<p>Define the <code>saveState()</code> method to put the data out to the
database.</p>
    <pre>
     private void saveState() {
        String title = mTitleText.getText().toString();
        String body = mBodyText.getText().toString();

        if (mRowId == null) {
            long id = mDbHelper.createNote(title, body);
            if (id > 0) {
                mRowId = id;
            }
        } else {
            mDbHelper.updateNote(mRowId, title, body);
        }
    }</pre>
  <p>Note that we capture the return value from <code>createNote()</code> and if a valid row ID is
  returned, we store it in the <code>mRowId</code> field so that we can update the note in future
  rather than create a new one (which otherwise might happen if the life-cycle events are
  triggered).</p>


<h2 style="clear:right;">Step 9</h2>

<p>Now pull out the previous handling code from the
    <code>onActivityResult()</code> method in the <code>Notepadv3</code>
    class.</p>
<p>All of the note retrieval and updating now happens within the
    <code>NoteEdit</code> life cycle, so all the <code>onActivityResult()</code>
    method needs to do is update its view of the data, no other work is
    necessary. The resulting method should look like this:</p>
<pre>
&#64;Override
protected void onActivityResult(int requestCode, int resultCode, 
                                Intent intent) {
    super.onActivityResult(requestCode, resultCode, intent);
    fillData();
}</pre>

<p>Because the other class now does the work, all this has to do is refresh
      the data.</p>
 
<h2>Step 10</h2>

<p>Also remove the lines which set the title and body from the
    <code>onListItemClick()</code> method (again they are no longer needed, 
    only the <code>mRowId</code> is):</p>
<pre>
    Cursor c = mNotesCursor;
    c.moveToPosition(position);</pre>
<br>
and also remove:
<br>
<pre>
    i.putExtra(NotesDbAdapter.KEY_TITLE, c.getString(
                    c.getColumnIndex(NotesDbAdapter.KEY_TITLE)));
    i.putExtra(NotesDbAdapter.KEY_BODY, c.getString(
                    c.getColumnIndex(NotesDbAdapter.KEY_BODY)));</pre>
<br>
so that all that should be left in that method is:
<br>
<pre>
    super.onListItemClick(l, v, position, id);
    Intent i = new Intent(this, NoteEdit.class);
    i.putExtra(NotesDbAdapter.KEY_ROWID, id);
    startActivityForResult(i, ACTIVITY_EDIT);</pre>

  <p>You can also now remove the mNotesCursor field from the class, and set it back to using
  a local variable in the <code>fillData()</code> method:
<br><pre>
    Cursor notesCursor = mDbHelper.fetchAllNotes();</pre></p>
  <p>Note that the <code>m</code> in <code>mNotesCursor</code> denotes a member field, so when we
  make <code>notesCursor</code> a local variable, we drop the <code>m</code>. Remember to rename the
  other occurrences of <code>mNotesCursor</code> in your <code>fillData()</code> method.
</ol>
<p>
Run it! (use <em>Run As -&gt; Android Application</em> on the project right 
click menu again)</p>

<h2>Solution and Next Steps</h2>

<p>You can see the solution to this exercise in <code>Notepadv3Solution</code>
from 
the zip file to compare with your own.</p>
<p>
When you are ready, move on to the <a href="notepad-extra-credit.html">Tutorial
Extra Credit</a> exercise, where you can use the Eclipse debugger to
examine the life-cycle events as they happen.</p>

    </div>

  <a href="#top" style="float:right">&uarr; Go to top</a>
  
    <p><a href="index.html">&larr; Back to Notepad Tutorial</a></p>
  
  </div>

<div id="footer">


  <div id="copyright">
    
  Except as noted, this content is licensed under <a
  href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0</a>. 
  For details and restrictions, see the <a href="../../../license.html">
  Content License</a>.
  </div>
  <div id="build_info">
    
  Android 1.5&nbsp;r1 - 26  8月 2009 22:34

  </div>

  <div id="footerlinks">
    
  <p>
    <a href="http://www.android.com/terms.html">Site Terms of Service</a> -
    <a href="http://www.android.com/privacy.html">Privacy Policy</a> -
    <a href="http://www.android.com/branding.html">Brand Guidelines</a>
  </p>
  </div>

</div> <!-- end footer -->

</div><!-- end doc-content -->

</div> <!-- end body-content --> 

<script type="text/javascript">
init(); /* initialize android-developer-docs.js */
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-5831155-1");
pageTracker._trackPageview();
</script>

</body>
</html>



